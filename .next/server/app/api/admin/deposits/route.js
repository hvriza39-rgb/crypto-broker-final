"use strict";(()=>{var e={};e.id=1105,e.ids=[1105],e.modules={8013:e=>{e.exports=require("mongodb")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},2900:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>v,patchFetch:()=>j,requestAsyncStorage:()=>m,routeModule:()=>l,serverHooks:()=>g,staticGenerationAsyncStorage:()=>x});var s={};r.r(s),r.d(s,{GET:()=>c,PUT:()=>p});var o=r(9303),n=r(8716),a=r(3131),i=r(7070),d=r(9487),u=r(8013);async function c(e){try{let e=await (0,d.z)(),t=await e.collection("transactions").aggregate([{$match:{type:"deposit",status:"Pending"}},{$lookup:{from:"users",localField:"userId",foreignField:"_id",as:"user"}},{$unwind:"$user"},{$project:{_id:1,amount:1,asset:1,network:1,proof:1,date:1,"user.name":1,"user.email":1}}]).toArray();return i.NextResponse.json(t)}catch(e){return i.NextResponse.json({error:"Server Error"},{status:500})}}async function p(e){try{let{transactionId:t,action:r}=await e.json(),s=await (0,d.z)(),o=new u.ObjectId(t),n=await s.collection("transactions").findOne({_id:o});if(!n)return i.NextResponse.json({error:"Transaction not found"},{status:404});if("Pending"!==n.status)return i.NextResponse.json({error:"Transaction already processed"},{status:400});if("approve"===r)return await s.collection("transactions").updateOne({_id:o},{$set:{status:"Completed"}}),await s.collection("users").updateOne({_id:n.userId},{$inc:{balance:n.amount}}),i.NextResponse.json({success:!0,message:"Deposit Approved"});if("reject"===r)return await s.collection("transactions").updateOne({_id:o},{$set:{status:"Rejected"}}),i.NextResponse.json({success:!0,message:"Deposit Rejected"});return i.NextResponse.json({error:"Invalid action"},{status:400})}catch(e){return console.error("Admin Error:",e),i.NextResponse.json({error:"Server Error"},{status:500})}}let l=new o.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/admin/deposits/route",pathname:"/api/admin/deposits",filename:"route",bundlePath:"app/api/admin/deposits/route"},resolvedPagePath:"C:\\Users\\user\\Documents\\web-upload\\crypto-broker-dashboard-with-admin-connected-backend\\app\\api\\admin\\deposits\\route.tsx",nextConfigOutput:"",userland:s}),{requestAsyncStorage:m,staticGenerationAsyncStorage:x,serverHooks:g}=l,v="/api/admin/deposits/route";function j(){return(0,a.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:x})}},9487:(e,t,r)=>{let s;r.d(t,{z:()=>a});var o=r(8013);process.env.MONGODB_URI||(process.env.MONGODB_URI="mongodb://localhost:27017/broker-dashboard");let n=process.env.MONGODB_URI;async function a(){return(await s).db()}s=new o.MongoClient(n,{}).connect()}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[9276,5972],()=>r(2900));module.exports=s})();