"use strict";(()=>{var e={};e.id=4126,e.ids=[4126],e.modules={8013:e=>{e.exports=require("mongodb")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8893:e=>{e.exports=require("buffer")},4770:e=>{e.exports=require("crypto")},6162:e=>{e.exports=require("stream")},1764:e=>{e.exports=require("util")},3882:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>g,patchFetch:()=>b,requestAsyncStorage:()=>m,routeModule:()=>h,serverHooks:()=>f,staticGenerationAsyncStorage:()=>x});var n={};r.r(n),r.d(n,{POST:()=>w});var a=r(9303),o=r(8716),s=r(3131),i=r(7070),u=r(9487),c=r(8013),d=r(1482),p=r.n(d);let l=process.env.JWT_SECRET||"your-secret-key";async function w(e){try{let t=e.headers.get("Authorization");if(!t||!t.startsWith("Bearer "))return i.NextResponse.json({error:"Unauthorized"},{status:401});let r=t.split(" ")[1],n=p().verify(r,l),{amount:a,asset:o,network:s,address:d}=await e.json(),w=Number(a),h=new c.ObjectId(n.id);console.log(`Processing Withdrawal: User ${h}, Amount: ${w}`);let m=await (0,u.z)(),x=await m.collection("users").findOne({_id:h}),f=x?.balance||0;if(f<w)return i.NextResponse.json({error:"Insufficient funds"},{status:400});let g=await m.collection("users").updateOne({_id:h},{$inc:{balance:-w}});if(console.log("Update Result:",g),0===g.modifiedCount)return i.NextResponse.json({error:"Balance update failed. Please try again."},{status:500});return await m.collection("transactions").insertOne({userId:h,type:"withdrawal",amount:w,asset:o,network:s,address:d,status:"Pending",date:new Date().toISOString().split("T")[0],timestamp:new Date}),i.NextResponse.json({success:!0,newBalance:f-w})}catch(e){return console.error("Withdraw API Error:",e),i.NextResponse.json({error:"Internal Server Error"},{status:500})}}let h=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/transaction/withdraw/route",pathname:"/api/transaction/withdraw",filename:"route",bundlePath:"app/api/transaction/withdraw/route"},resolvedPagePath:"C:\\Users\\user\\Documents\\web-upload\\crypto-broker-dashboard-with-admin-connected-backend\\app\\api\\transaction\\withdraw\\route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:m,staticGenerationAsyncStorage:x,serverHooks:f}=h,g="/api/transaction/withdraw/route";function b(){return(0,s.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:x})}},9487:(e,t,r)=>{let n;r.d(t,{z:()=>s});var a=r(8013);process.env.MONGODB_URI||(process.env.MONGODB_URI="mongodb://localhost:27017/broker-dashboard");let o=process.env.MONGODB_URI;async function s(){return(await n).db()}n=new a.MongoClient(o,{}).connect()}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[9276,5972,1482],()=>r(3882));module.exports=n})();